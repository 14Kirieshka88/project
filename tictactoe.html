<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏ Deluxe</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1f2937">

    <style>
        :root {
            --main-bg: #1f2937; /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π */
            --container-bg: #374151; /* –°—Ä–µ–¥–Ω–µ-—Å–µ—Ä—ã–π */
            --button-bg: #4f46e5; /* –Ø—Ä–∫–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
            --button-hover-bg: #6366f1;
            --x-color: #ef4444; /* –Ø—Ä–∫–æ-–∫—Ä–∞—Å–Ω—ã–π */
            --o-color: #3b82f6; /* –Ø—Ä–∫–æ-—Å–∏–Ω–∏–π */
            --text-color: #f3f4f6; /* –û—á–µ–Ω—å —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π */
            --border-color: #6b7280; /* –°–µ—Ä—ã–π –¥–ª—è –ª–∏–Ω–∏–π */
            --shadow-color: rgba(0, 0, 0, 0.6);
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;

            /* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ñ–æ–Ω–∞ —Ç–µ–ª–∞ */
            --body-bg-start: #111827;
            --body-bg-end: var(--main-bg);
            --body-bg-direction: 135deg;
            --body-bg-size: auto; /* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
            --body-bg-animation: none; /* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            /* –§–æ–Ω —Ç–µ–ø–µ—Ä—å —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ */
            background: linear-gradient(var(--body-bg-direction), var(--body-bg-start) 0%, var(--body-bg-end) 100%);
            background-size: var(--body-bg-size); /* –î–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
            animation: var(--body-bg-animation); /* –î–ª—è –∞–Ω–∏–º–∞—Ü–∏—è */

            font-family: var(--font-family);
            color: var(--text-color);
            overflow: hidden;
            transition: background 0.5s ease; /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Ñ–æ–Ω–∞–º–∏ */
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Ñ–æ–Ω–∞ (–ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è, –µ—Å–ª–∏ --body-bg-animation –Ω–µ 'none') */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }


        .screen {
            display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 90%;
            max-width: 500px;
            padding: 25px;
            background-color: var(--container-bg);
            border-radius: 20px;
            box-shadow: 0 20px 40px var(--shadow-color);
            text-align: center;
        }

        .screen.active {
            display: flex; /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–∫—Ä–∞–Ω */
        }

        h1, h2 {
            color: var(--text-color);
            text-shadow: 0 0 8px rgba(255,255,255,0.3);
        }
        h1 { font-size: 2.8em; margin-bottom: 30px; }
        h2 { font-size: 2em; margin-bottom: 20px; }


        .menu-button, .back-button {
            background-color: var(--button-bg);
            color: var(--text-color);
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            margin: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
            width: 250px;
            text-align: center;
        }

        .menu-button:hover, .back-button:hover {
            background-color: var(--button-hover-bg);
            transform: translateY(-3px);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è */
        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            width: 300px;
            height: 300px;
            gap: 8px;
            background-color: var(--main-bg);
            padding: 8px;
            border-radius: 12px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.4), 0 3px 8px var(--shadow-color);
            margin-bottom: 20px;
        }

        .cell {
            background-color: var(--container-bg); /* –¢–µ–º–Ω–µ–µ, —á–µ–º —Ñ–æ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–≥—Ä—ã */
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2) inset, 0 1px 1px rgba(255,255,255,0.05);
        }

        .cell:hover {
            background-color: #4b5563; /* –ß—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        }

        /* –¶–≤–µ—Ç –∏ —Å—Ç–∏–ª—å —Å–∏–º–≤–æ–ª–æ–≤ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ç–µ–∫—É—â–µ–π —Ç–µ–º—ã */
        .cell.x { color: var(--x-color); text-shadow: 0 0 7px var(--x-color), 0 0 3px black; }
        .cell.o { color: var(--o-color); text-shadow: 0 0 7px var(--o-color), 0 0 3px black; }

        .cell.x::before, .cell.o::before {
            opacity: 0;
            transform: scale(0.5);
            animation: appear 0.3s ease-out forwards;
            /* –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∏–º–≤–æ–ª–æ–≤ –æ—Å—Ç–∞–µ—Ç—Å—è X –∏ O */
        }
        /* –ó–¥–µ—Å—å –º—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º ::before –¥–ª—è —Å–∏–º–≤–æ–ª–æ–≤, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ (—ç–º–æ–¥–∑–∏, —Ü–∏—Ñ—Ä—ã).
           –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å—Å—è –ø—Ä—è–º–æ –≤ span –≤–Ω—É—Ç—Ä–∏ —è—á–µ–π–∫–∏. */


        @keyframes appear {
            to { opacity: 1; transform: scale(1); }
        }

        .status {
            margin-bottom: 15px;
            font-size: 1.4em;
            min-height: 1.4em;
            /* –¶–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ–∂–µ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤ —Ç–µ–º–∞—Ö */
        }

        button#resetButtonGame { /* –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞ –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ */
             /* –§–æ–Ω –∫–Ω–æ–ø–∫–∏ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º X –∏ O - –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤ —Ç–µ–º–∞—Ö */
            background: linear-gradient(145deg, var(--x-color), var(--o-color));
            color: var(--text-color);
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 1.1em;
            font-weight: bold;
            margin-top:10px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease; /* –î–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è —Ñ–æ–Ω–∞ */
            box-shadow: 0 4px 8px var(--shadow-color);
        }
        button#resetButtonGame:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 12px var(--shadow-color);
        }


        .audio-controls {
            margin-top: 20px;
        }
        audio {
            border-radius: 25px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 5px var(--shadow-color);
            width: 100%;
            max-width: 300px;
        }

        /* –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä */
        #historyList {
            list-style: none;
            padding: 0;
            width: 100%;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 20px;
        }
        #historyList li {
            padding: 10px 15px;
            border-bottom: 1px solid var(--border-color);
            background-color: #4b5563; /* –≠—Ç–æ—Ç —Ü–≤–µ—Ç —Ç–æ–∂–µ –º–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–º—ã */
        }
        #historyList li:last-child {
            border-bottom: none;
        }
        #historyList li:nth-child(odd) {
            background-color: var(--container-bg); /* –≠—Ç–æ—Ç —Ü–≤–µ—Ç —Ç–æ–∂–µ –º–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–º—ã */
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –î–∏–Ω–æ–∑–∞–≤—Ä */
        .dino-builder {
            font-family: monospace;
            white-space: pre;
            font-size: 1.2em; /* –†–∞–∑–º–µ—Ä –¥–∏–Ω–æ –º–æ–∂–Ω–æ –ø–æ–¥—Å—Ç—Ä–æ–∏—Ç—å */
            line-height: 1;
            color: #2ecc71; /* –ó–µ–ª–µ–Ω—ã–π –¥–∏–Ω–æ */
            margin: 20px 0;
            padding:10px;
            border: 2px dashed var(--border-color);
            border-radius: 10px;
            background-color: rgba(0,0,0,0.2);
        }
        .settings-message {
            font-size: 1.3em;
            margin-top: 10px;
            color: #f1c40f; /* –ñ–µ–ª—Ç—ã–π –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è */
        }

        /* --- –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –¢–µ–º --- */
        #themesScreen .themes-category {
            width: 100%;
            margin-bottom: 25px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ */
        }
        #themesScreen .themes-category h3 {
            color: var(--text-color);
            font-size: 1.6em;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 5px;
            text-align: left;
            width: 100%;
        }

        #themesScreen .themes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ */
            gap: 15px;
            width: 100%;
            /* margin-bottom: 20px; */ /* –ü–µ—Ä–µ–º–µ—â–µ–Ω–æ –≤ .themes-category */
        }

        #themesScreen .themes-container { /* –ù–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
            width: 100%;
            max-height: 400px; /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
            overflow-y: auto; /* –í–∫–ª—é—á–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
            padding-right: 10px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è –ø–æ–ª–æ—Å—ã –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
            box-sizing: border-box; /* –£—á–∏—Ç—ã–≤–∞–µ–º padding –≤ —à–∏—Ä–∏–Ω–µ */
        }
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–æ—Å—ã –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ (Webkit) */
        #themesScreen .themes-container::-webkit-scrollbar {
            width: 8px;
        }
        #themesScreen .themes-container::-webkit-scrollbar-track {
            background: #374151; /* –¶–≤–µ—Ç —Ç—Ä–µ–∫–∞ */
            border-radius: 10px;
        }
        #themesScreen .themes-container::-webkit-scrollbar-thumb {
            background: var(--button-bg); /* –¶–≤–µ—Ç –ø–æ–ª–∑—É–Ω–∫–∞ */
            border-radius: 10px;
        }
        #themesScreen .themes-container::-webkit-scrollbar-thumb:hover {
            background: var(--button-hover-bg);
        }


        #themesScreen .theme-option {
            background-color: var(--main-bg); /* –§–æ–Ω –∫–Ω–æ–ø–∫–∏ —Ç–µ–º—ã */
            border: 2px solid var(--border-color); /* –†–∞–º–∫–∞ */
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: transform 0.2s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1em;
            font-weight: bold;
            color: var(--text-color); /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–µ–º—ã */
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        #themesScreen .theme-option:hover {
            transform: translateY(-3px);
            border-color: var(--button-hover-bg); /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–∞–º–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

         #themesScreen .theme-option.selected {
            border-color: var(--button-bg); /* –Ø—Ä–∫–∞—è —Ä–∞–º–∫–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º—ã */
            transform: scale(1.05); /* –ù–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ç–µ–º—É */
            box-shadow: 0 0 15px var(--button-bg), 0 0 8px var(--button-bg); /* –°–∏—è–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º—ã */
        }


        #themesScreen .theme-preview {
            width: 60px; /* –†–∞–∑–º–µ—Ä –ø—Ä–µ–≤—å—é */
            height: 60px;
            border-radius: 8px;
            margin-bottom: 10px;
            position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–≤ –≤–Ω—É—Ç—Ä–∏ */
            overflow: hidden; /* –°–∫—Ä—ã–≤–∞–µ–º, –µ—Å–ª–∏ —Å–∏–º–≤–æ–ª—ã –≤—ã—Ö–æ–¥—è—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã */
            background-color: var(--container-bg); /* –§–æ–Ω –ø—Ä–µ–≤—å—é */
            display: flex; /* –î–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è, –µ—Å–ª–∏ —Å–∏–º–≤–æ–ª –æ–¥–∏–Ω */
            align-items: center;
            justify-content: center;
            font-size: 2.5em; /* –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –¥–ª—è —á–∏—Å–µ–ª/—ç–º–æ–¥–∑–∏ */
        }

        #themesScreen .theme-preview .preview-x,
        #themesScreen .theme-preview .preview-o {
            position: absolute; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–≤ X –∏ O */
            font-size: 1.8em; /* –†–∞–∑–º–µ—Ä —Å–∏–º–≤–æ–ª–æ–≤ –≤ –ø—Ä–µ–≤—å—é */
            font-weight: bold;
            text-shadow: 0 0 4px rgba(0,0,0,0.5);
            /* animation: appear 0.3s ease-out forwards; */ /* –ê–Ω–∏–º–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞ –¥–ª—è –ø—Ä–µ–≤—å—é */
        }
        #themesScreen .theme-preview .preview-x {
            color: var(--preview-x-color); /* –¶–≤–µ—Ç X –¥–ª—è –ø—Ä–µ–≤—å—é */
            top: 5px; left: 5px;
        }
        #themesScreen .theme-preview .preview-o {
            color: var(--preview-o-color); /* –¶–≤–µ—Ç O –¥–ª—è –ø—Ä–µ–≤—å—é */
            bottom: 5px; right: 5px;
        }
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è "—Å–∫—É—á–Ω—ã—Ö —É—Ä–æ–∫–æ–≤" */
        #themesScreen .theme-preview.boring-lessons .preview-x {
             color: black; /* –ß–µ—Ä–Ω—ã–π –¥–ª—è –∫–∞—Ä–∞–Ω–¥–∞—à–∞ */
             font-weight: normal; /* –ë–æ–ª–µ–µ —Ç–æ–Ω–∫–∏–π —à—Ä–∏—Ñ—Ç */
             opacity: 0.8; /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å */
             transform: scaleX(0.8) rotate(-45deg); /* –ò–º–∏—Ç–∞—Ü–∏—è –∫—Ä–µ—Å—Ç–∏–∫–∞ –∫–∞—Ä–∞–Ω–¥–∞—à–æ–º */
        }
        #themesScreen .theme-preview.boring-lessons .preview-o {
             color: black;
             font-weight: normal;
             opacity: 0.8;
             transform: scale(0.9); /* –°–¥–µ–ª–∞—Ç—å —á—É—Ç—å –º–µ–Ω—å—à–µ, —á—Ç–æ–±—ã –≤—ã–≥–ª—è–¥–µ–ª–æ –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω–Ω—ã–º */
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –≤–µ—Ä—Å–∏–∏ */
        #versionText {
            margin-top: 20px;
            font-size: 1em;
            color: rgba(255, 255, 255, 0.6); /* –ü—Ä–æ–∑—Ä–∞—á–Ω–æ-–±–µ–ª–æ–≤–∞—Ç—ã–π */
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
        }

    </style>
</head>
<body>

    <div id="mainMenuScreen" class="screen active">
        <h1>–ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏ Deluxe</h1>
        <button class="menu-button" onclick="showScreen('gameScreen'); startGame();">–ò–≥—Ä–∞—Ç—å</button>
        <button class="menu-button" onclick="showScreen('historyScreen'); loadHistory();">–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</button>
        <button class="menu-button" onclick="showScreen('themesScreen')">–¢–µ–º—ã</button>
        <button class="menu-button" onclick="showScreen('settingsScreen')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <p id="versionText">Version: 1</p>
    </div>

    <div id="gameScreen" class="screen">
        <h2>–ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏</h2>
        <div class="status" id="status">–•–æ–¥ –∏–≥—Ä–æ–∫–∞ X</div>
        <div class="board" id="board">
            </div>
        <button id="resetButtonGame">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
        <button class="back-button" onclick="showScreen('mainMenuScreen')">–í –º–µ–Ω—é</button>
    </div>

    <div id="historyScreen" class="screen">
        <h2>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–±–µ–¥</h2>
        <ul id="historyList">
            </ul>
        <button class="back-button" onclick="showScreen('mainMenuScreen')">–í –º–µ–Ω—é</button>
    </div>

    <div id="settingsScreen" class="screen">
        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
        <div class="dino-builder">
          /\_/\
         / o o \
        (  (_Y_)  )
         \ \   / / –Ø —Å—Ç—Ä–æ–∏—Ç–µ–ª—å!
          \ '-' /  []--[]
           '---'  [][][]
        </div>
        <p class="settings-message">–ü—Ä–æ—Å—Ç–∏—Ç–µ, —è —Å–ª—É—á–∞–π–Ω–æ –≤—Å–µ —Å–ª–æ–º–∞–ª... <br>(–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!)</p>
        <button class="back-button" onclick="showScreen('mainMenuScreen')">–í –º–µ–Ω—é</button>
    </div>

    <div id="themesScreen" class="screen">
        <h2>–í—ã–±–æ—Ä –¢–µ–º—ã</h2>
        <div class="themes-container"> <div id="ordinaryThemes" class="themes-category">
                <h3>–û–±—ã—á–Ω—ã–µ</h3>
                <div class="themes-grid">
                    </div>
            </div>

            <div id="specialThemes" class="themes-category">
                <h3>–û—Å–æ–±—ã–µ</h3>
                <div class="themes-grid">
                    </div>
            </div>
        </div>
        <button class="back-button" onclick="showScreen('mainMenuScreen')">–í –º–µ–Ω—é</button>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const screens = document.querySelectorAll('.screen');
        const boardElement = document.getElementById('board');
        const statusDisplay = document.getElementById('status');
        const resetButtonGame = document.getElementById('resetButtonGame');
        // const backgroundMusic = document.getElementById('backgroundMusic'); // –£–¥–∞–ª–µ–Ω
        const historyListElement = document.getElementById('historyList');
        const ordinaryThemesGridElement = document.querySelector('#ordinaryThemes .themes-grid'); // –≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Ç–µ–º
        const specialThemesGridElement = document.querySelector('#specialThemes .themes-grid'); // –≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Å–æ–±—ã—Ö —Ç–µ–º
        const root = document.documentElement; // –î–æ—Å—Ç—É–ø –∫ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let currentPlayer = 'X';
        let gameActive = true;
        let gameState = ["", "", "", "", "", "", "", "", ""];
        let gameStartTime;
        let gameHistory = JSON.parse(localStorage.getItem('ticTacToeHistory')) || [];

        const winningConditions = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8],
            [0, 3, 6], [1, 4, 7], [2, 5, 8],
            [0, 4, 8], [2, 4, 6]
        ];

         // --- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¢–µ–º ---
         const themes = {
             'default': {
                 name: '–ü–æ –£–º–æ–ª—á–∞–Ω–∏—é',
                 category: 'ordinary',
                 vars: {
                    '--main-bg': '#1f2937',
                    '--container-bg': '#374151',
                    '--button-bg': '#4f46e5',
                    '--button-hover-bg': '#6366f1',
                    '--x-color': '#ef4444',
                    '--o-color': '#3b82f6',
                    '--text-color': '#f3f4f6',
                    '--border-color': '#6b7280',
                    '--shadow-color': 'rgba(0, 0, 0, 0.6)',
                    '--body-bg-start': '#111827',
                    '--body-bg-end': '#1f2937',
                    '--body-bg-direction': '135deg',
                    '--body-bg-size': 'auto',
                    '--body-bg-animation': 'none',
                 },
                 marks: { x: 'X', o: 'O' }, // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
                 preview: { '--preview-x-color': '#ef4444', '--preview-o-color': '#3b82f6' }
             },
             'forest': {
                 name: '–õ–µ—Å',
                 category: 'ordinary',
                 vars: {
                    '--main-bg': '#1e3a24', /* –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π */
                    '--container-bg': '#224d2b', /* –°—Ä–µ–¥–Ω–µ-–∑–µ–ª–µ–Ω—ã–π */
                    '--button-bg': '#346c41', /* –ó–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
                    '--button-hover-bg': '#4a805a',
                    '--x-color': '#facc15', /* –ó–æ–ª–æ—Ç–∏—Å—Ç—ã–π */
                    '--o-color': '#a7f3d0', /* –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π */
                    '--text-color': '#d1fae5', /* –û—á–µ–Ω—å —Å–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π */
                    '--border-color': '#4b5563', /* –°–µ—Ä—ã–π */
                    '--shadow-color': 'rgba(0, 0, 0, 0.6)',
                    '--body-bg-start': '#064e3b', /* –¢–µ–º–Ω–æ-–∏–∑—É–º—Ä—É–¥–Ω—ã–π */
                    '--body-bg-end': '#1e3a24',
                    '--body-bg-direction': 'top right',
                    '--body-bg-size': 'auto',
                    '--body-bg-animation': 'none',
                 },
                 marks: { x: 'X', o: 'O' },
                 preview: { '--preview-x-color': '#facc15', '--preview-o-color': '#a7f3d0' }
             },
             'ocean': {
                 name: '–û–∫–µ–∞–Ω',
                 category: 'ordinary',
                 vars: {
                    '--main-bg': '#1e3a8a', /* –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π */
                    '--container-bg': '#1c4a7b', /* –°—Ä–µ–¥–Ω–µ-—Å–∏–Ω–∏–π */
                    '--button-bg': '#2563eb', /* –ì–æ–ª—É–±–∞—è –∫–Ω–æ–ø–∫–∞ */
                    '--button-hover-bg': '#3b82f6',
                    '--x-color': '#f87171', /* –ö–æ—Ä–∞–ª–ª */
                    '--o-color': '#bfdbfe', /* –û—á–µ–Ω—å —Å–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π */
                    '--text-color': '#eff6ff', /* –ü–æ—á—Ç–∏ –±–µ–ª—ã–π */
                    '--border-color': '#60a5fa', /* –°–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π */
                    '--shadow-color': 'rgba(0, 0, 0, 0.6)',
                    '--body-bg-start': '#0b173b', /* –û—á–µ–Ω—å —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π */
                    '--body-bg-end': '#1e3a8a',
                    '--body-bg-direction': 'bottom left',
                    '--body-bg-size': 'auto',
                    '--body-bg-animation': 'none',
                 },
                 marks: { x: 'X', o: 'O' },
                 preview: { '--preview-x-color': '#f87171', '--preview-o-color': '#bfdbfe' }
             },
              'lava': {
                 name: '–õ–∞–≤–∞',
                 category: 'ordinary',
                 vars: {
                    '--main-bg': '#450a0a', /* –¢–µ–º–Ω–æ-–±–æ—Ä–¥–æ–≤—ã–π */
                    '--container-bg': '#7f1d1d', /* –ö—Ä–∞—Å–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π */
                    '--button-bg': '#dc2626', /* –ö—Ä–∞—Å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
                    '--button-hover-bg': '#ef4444',
                    '--x-color': '#fef08a', /* –û—á–µ–Ω—å —Å–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π */
                    '--o-color': '#f97316', /* –û—Ä–∞–Ω–∂–µ–≤—ã–π */
                    '--text-color': '#fef2f2', /* –ü–æ—á—Ç–∏ –±–µ–ª—ã–π */
                    '--border-color': '#b91c1c', /* –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π */
                    '--shadow-color': 'rgba(0, 0, 0, 0.8)',
                    '--body-bg-start': '#0c0606', /* –ü–æ—á—Ç–∏ —á–µ—Ä–Ω—ã–π */
                    '--body-bg-end': '#450a0a',
                    '--body-bg-direction': 'to top',
                    '--body-bg-size': '600% 600%', /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
                    '--body-bg-animation': 'gradientShift 30s ease infinite', /* –í–∫–ª—é—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è —ç—Ç–æ–π —Ç–µ–º—ã */
                 },
                 marks: { x: 'X', o: 'O' },
                 preview: { '--preview-x-color': '#fef08a', '--preview-o-color': '#f97316' }
             },
             'excellent-poor': { // –ù–æ–≤–∞—è —Ç–µ–º–∞: –û—Ç–ª–∏—á–Ω–∏–∫ –ø—Ä–æ—Ç–∏–≤ –¥–≤–æ–µ—á–Ω–∏–∫–∞
                 name: '–û—Ç–ª–∏—á–Ω–∏–∫ vs –î–≤–æ–µ—á–Ω–∏–∫',
                 category: 'special',
                 vars: {
                    '--main-bg': '#ffffff', /* –í—Ä–µ–º–µ–Ω–Ω–æ –±–µ–ª—ã–π —Ñ–æ–Ω */
                    '--container-bg': '#f0f0f0',
                    '--button-bg': '#4CAF50', /* –ó–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
                    '--button-hover-bg': '#66BB6A',
                    '--x-color': '#ef4444', /* –ö—Ä–∞—Å–Ω–∞—è */
                    '--o-color': '#3b82f6', /* –°–∏–Ω—è—è */
                    '--text-color': '#333333', /* –¢–µ–º–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ —Å–≤–µ—Ç–ª–æ–º —Ñ–æ–Ω–µ */
                    '--border-color': '#cccccc',
                    '--shadow-color': 'rgba(0, 0, 0, 0.2)',
                    '--body-bg-start': '#ffffff', /* –í—Ä–µ–º–µ–Ω–Ω–æ –±–µ–ª—ã–π —Ñ–æ–Ω */
                    '--body-bg-end': '#f0f0f0',
                    '--body-bg-direction': '135deg',
                    '--body-bg-size': 'auto',
                    '--body-bg-animation': 'none',
                 },
                 marks: { x: '2', o: '5' }, // –°–∏–º–≤–æ–ª—ã 2 –∏ 5
                 preview: { '--preview-x-color': '#ef4444', '--preview-o-color': '#3b82f6' }
             },
             'stars-moon': {
                 name: '–ó–≤–µ–∑–¥—ã –∏ –õ—É–Ω–∞',
                 category: 'special', // –≠—Ç–∞ —Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –æ—Å–æ–±–∞—è
                 vars: {
                    '--main-bg': '#0a0a23', /* –û—á–µ–Ω—å —Ç–µ–º–Ω—ã–π —Å–∏–Ω–∏–π/—á–µ—Ä–Ω—ã–π */
                    '--container-bg': '#1a1a3b', /* –¢–µ–º–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
                    '--button-bg': '#3a245c', /* –¢–µ–º–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
                    '--button-hover-bg': '#5a3b8d', /* –ß—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
                    '--x-color': '#ffffa0', /* –°–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π (—Ü–≤–µ—Ç –∑–≤–µ–∑–¥—ã) */
                    '--o-color': '#f0f0f0', /* –ë–µ–ª—ã–π/–æ—á–µ–Ω—å —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π (—Ü–≤–µ—Ç –ª—É–Ω—ã) */
                    '--text-color': '#e0e0ff', /* –°–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π/—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
                    '--border-color': '#404060', /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π/—Å–∏–Ω–∏–π */
                    '--shadow-color': 'rgba(0, 0, 0, 0.8)',
                    '--body-bg-start': '#000000', /* –ß–µ—Ä–Ω—ã–π –∫–æ—Å–º–æ—Å */
                    '--body-bg-end': '#1a1a3b',
                    '--body-bg-direction': 'to bottom right',
                    '--body-bg-size': 'auto',
                    '--body-bg-animation': 'none', /* –ë–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏ —Ñ–æ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
                 },
                 marks: { x: 'X', o: 'O' }, // –ò—Å–ø–æ–ª—å–∑—É–µ–º X –∏ O –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                 preview: { '--preview-x-color': '#ffffa0', '--preview-o-color': '#f0f0f0' }
             },
             'stars-moon-emoji': { // –ù–æ–≤–∞—è —Ç–µ–º–∞: –ó–≤–µ–∑–¥—ã –∏ –õ—É–Ω–∞ –≠–º–æ–¥–∑–∏ –≤–µ—Ä—Å–∏—è
                 name: '–ó–≤–µ–∑–¥—ã –∏ –õ—É–Ω–∞ (–≠–º–æ–¥–∑–∏)',
                 category: 'special',
                 vars: {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —á—Ç–æ –∏ —É –æ–±—ã—á–Ω–æ–π —Ç–µ–º—ã "–ó–≤–µ–∑–¥—ã –∏ –õ—É–Ω–∞"
                    '--main-bg': '#0a0a23',
                    '--container-bg': '#1a1a3b',
                    '--button-bg': '#3a245c',
                    '--button-hover-bg': '#5a3b8d',
                    // –¶–≤–µ—Ç–∞ X –∏ O –∑–¥–µ—Å—å –Ω–µ —Ç–∞–∫ –≤–∞–∂–Ω—ã, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ —ç–º–æ–¥–∑–∏,
                    // –Ω–æ –æ–Ω–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞
                    '--x-color': '#ffffa0',
                    '--o-color': '#f0f0f0',
                    '--text-color': '#e0e0ff',
                    '--border-color': '#404060',
                    '--shadow-color': 'rgba(0, 0, 0, 0.8)',
                    '--body-bg-start': '#000000',
                    '--body-bg-end': '#1a1a3b',
                    '--body-bg-direction': 'to bottom right',
                    '--body-bg-size': 'auto',
                    '--body-bg-animation': 'none',
                 },
                 marks: { x: '‚≠ê', o: 'üåï' }, // –≠–º–æ–¥–∑–∏ –∑–≤–µ–∑–¥—ã –∏ –ø–æ–ª–Ω–æ–π –ª—É–Ω—ã
                 preview: { '--preview-x-color': '#ffffa0', '--preview-o-color': '#f0f0f0' }
             },
             'boring-lessons': { // –ù–æ–≤–∞—è —Ç–µ–º–∞: –°–∫—É—á–Ω—ã–µ —É—Ä–æ–∫–∏
                 name: '–°–∫—É—á–Ω—ã–µ –£—Ä–æ–∫–∏',
                 category: 'ordinary',
                 vars: {
                    '--main-bg': '#ffffff', /* –í—Ä–µ–º–µ–Ω–Ω–æ –±–µ–ª—ã–π —Ñ–æ–Ω */
                    '--container-bg': '#f0f0f0',
                    '--button-bg': '#6b7280', /* –°–µ—Ä—ã–π –∫–∞–∫ –∫–∞—Ä–∞–Ω–¥–∞—à */
                    '--button-hover-bg': '#9ca3af',
                    '--x-color': 'black', /* –ß–µ—Ä–Ω—ã–π –¥–ª—è –∫–∞—Ä–∞–Ω–¥–∞—à–∞ */
                    '--o-color': 'black', /* –ß–µ—Ä–Ω—ã–π –¥–ª—è –∫–∞—Ä–∞–Ω–¥–∞—à–∞ */
                    '--text-color': '#333333',
                    '--border-color': '#cccccc',
                    '--shadow-color': 'rgba(0, 0, 0, 0.2)',
                    '--body-bg-start': '#ffffff', /* –í—Ä–µ–º–µ–Ω–Ω–æ –±–µ–ª—ã–π —Ñ–æ–Ω */
                    '--body-bg-end': '#f0f0f0',
                    '--body-bg-direction': '135deg',
                    '--body-bg-size': 'auto',
                    '--body-bg-animation': 'none',
                 },
                 marks: { x: 'X', o: 'O' }, // –ó–¥–µ—Å—å —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ CSS –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –∫–∞—Ä–∞–Ω–¥–∞—à–∞
                 preview: { '--preview-x-color': 'black', '--preview-o-color': 'black' }
             },
             'water-vs-lava': { // –ù–æ–≤–∞—è —Ç–µ–º–∞: –í–æ–¥–∞ –ø—Ä–æ—Ç–∏–≤ –õ–∞–≤—ã
                 name: '–í–æ–¥–∞ vs –õ–∞–≤–∞',
                 category: 'ordinary',
                 vars: {
                    '--main-bg': '#ff4500', /* –ù–∞—á–∞–ª—å–Ω—ã–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
                    '--container-bg': '#4169e1', /* –°–∏–Ω–∏–π */
                    '--button-bg': 'linear-gradient(90deg, #ff4500, #4169e1)',
                    '--button-hover-bg': 'linear-gradient(90deg, #ff6347, #6a5acd)',
                    '--x-color': '#ff4500', /* –û—Ä–∞–Ω–∂–µ–≤—ã–π */
                    '--o-color': '#4169e1', /* –°–∏–Ω–∏–π */
                    '--text-color': '#f3f4f6',
                    '--border-color': '#808080',
                    '--shadow-color': 'rgba(0, 0, 0, 0.6)',
                    '--body-bg-start': '#ff4500', /* –û—Ä–∞–Ω–∂–µ–≤—ã–π */
                    '--body-bg-end': '#4169e1', /* –°–∏–Ω–∏–π */
                    '--body-bg-direction': '45deg', /* –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ */
                    '--body-bg-size': '200% 200%', /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ–ª–∏–≤–∞ */
                    '--body-bg-animation': 'gradientShift 20s ease infinite alternate', /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–ª–∏–≤–∞ */
                 },
                 marks: { x: 'X', o: 'O' },
                 preview: { '--preview-x-color': '#ff4500', '--preview-o-color': '#4169e1' }
             }
         };

        let currentThemeKey = localStorage.getItem('ticTacToeTheme') || 'default';


        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞–º–∏ ---
        function showScreen(screenId) {
            screens.forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            // –ú—É–∑—ã–∫–∞ –±–æ–ª—å—à–µ –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –æ—Ç—Å—é–¥–∞
        }

        // --- –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã ---
        function startGame() {
            boardElement.innerHTML = ''; // –û—á–∏—â–∞–µ–º –¥–æ—Å–∫—É
            gameState = ["", "", "", "", "", "", "", "", ""];
            currentPlayer = 'X';
            gameActive = true;
            statusDisplay.textContent = `–•–æ–¥ –∏–≥—Ä–æ–∫–∞ ${currentPlayer}`;
             // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–π —Ç–µ–º—ã –∏ –∏–≥—Ä–æ–∫–∞
            statusDisplay.style.color = root.style.getPropertyValue(currentPlayer === 'X' ? '--x-color' : '--o-color');

            gameStartTime = new Date();

            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.index = i;
                cell.addEventListener('click', handleCellClick);
                boardElement.appendChild(cell);
            }
             // –ú—É–∑—ã–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã
        }

        function handleCellClick(event) {
            const clickedCell = event.target;
            const clickedCellIndex = parseInt(clickedCell.dataset.index);

            // --- –ü–†–û–í–ï–†–ö–ê –ù–ê –ó–ê–ù–Ø–¢–û–°–¢–¨ –Ø–ß–ï–ô–ö–ò ---
            if (gameState[clickedCellIndex] !== "" || !gameActive) {
                return;
            }
            // --- –ö–û–ù–ï–¶ –ü–†–û–í–ï–†–ö–ò ---

            gameState[clickedCellIndex] = currentPlayer;

            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é —Ç–µ–º—É, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, –∫–∞–∫–æ–π —Å–∏–º–≤–æ–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
            const currentTheme = themes[currentThemeKey];
            const markToShow = currentPlayer === 'X' ? currentTheme.marks.x : currentTheme.marks.o;

            clickedCell.innerHTML = markToShow; // –í—Å—Ç–∞–≤–ª—è–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π —Å–∏–º–≤–æ–ª
            clickedCell.classList.add(currentPlayer.toLowerCase()); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å 'x' –∏–ª–∏ 'o'

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è "—Å–∫—É—á–Ω—ã—Ö —É—Ä–æ–∫–æ–≤", —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏
            if (currentThemeKey === 'boring-lessons') {
                clickedCell.classList.add('boring-lessons');
            }


            checkResult();
        }

        function checkResult() {
            let roundWon = false;
            for (let i = 0; i < winningConditions.length; i++) {
                const winCondition = winningConditions[i];
                let a = gameState[winCondition[0]];
                let b = gameState[winCondition[1]];
                let c = gameState[winCondition[2]];
                if (a === '' || b === '' || c === '') continue;
                if (a === b && b === c) {
                    roundWon = true;
                    break;
                }
            }

            const gameEndTime = new Date();
            const gameDuration = Math.round((gameEndTime - gameStartTime) / 1000); // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

            if (roundWon) {
                statusDisplay.textContent = `–ò–≥—Ä–æ–∫ ${currentPlayer} –ø–æ–±–µ–¥–∏–ª –∑–∞ ${gameDuration} —Å–µ–∫!`;
                 statusDisplay.style.color = root.style.getPropertyValue(currentPlayer === 'X' ? '--x-color' : '--o-color');
                addHistoryRecord(`–ò–≥—Ä–æ–∫ ${currentPlayer}`, gameDuration);
                gameActive = false;
                return;
            }

            if (!gameState.includes("")) {
                statusDisplay.textContent = `–ù–∏—á—å—è –∑–∞ ${gameDuration} —Å–µ–∫!`;
                statusDisplay.style.color = root.style.getPropertyValue('--text-color'); // –¶–≤–µ—Ç –Ω–∏—á—å–µ–π –∏–∑ —Ç–µ–º—ã
                addHistoryRecord('–ù–∏—á—å—è', gameDuration);
                gameActive = false;
                return;
            }

            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            statusDisplay.textContent = `–•–æ–¥ –∏–≥—Ä–æ–∫–∞ ${currentPlayer}`;
             statusDisplay.style.color = root.style.getPropertyValue(currentPlayer === 'X' ? '--x-color' : '--o-color');
        }

        resetButtonGame.addEventListener('click', startGame);

        // --- –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä ---
        function addHistoryRecord(winner, duration) {
            const record = {
                winner: winner,
                duration: duration,
                date: new Date().toLocaleString('ru-RU')
            };
            gameHistory.unshift(record); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
            if (gameHistory.length > 20) { // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
                gameHistory.pop();
            }
            localStorage.setItem('ticTacToeHistory', JSON.stringify(gameHistory));
        }

        function loadHistory() {
            historyListElement.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫
            if (gameHistory.length === 0) {
                historyListElement.innerHTML = '<li>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞ –ø—É—Å—Ç–∞. –°—ã–≥—Ä–∞–π—Ç–µ –ø–∞—Ä—Ç–∏—é!</li>';
                return;
            }
            gameHistory.forEach(record => {
                const listItem = document.createElement('li');
                listItem.textContent = `${record.date} - ${record.winner}, –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${record.duration} —Å–µ–∫.`;
                historyListElement.appendChild(listItem);
            });
        }

         // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¢–µ–º–∞–º–∏ ---
        function applyTheme(themeKey) {
            const theme = themes[themeKey];
            if (!theme) {
                console.error('–¢–µ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', themeKey);
                return;
            }

            // –ü—Ä–∏–º–µ–Ω—è–µ–º CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–º—ã
            for (const [prop, value] of Object.entries(theme.vars)) {
                root.style.setProperty(prop, value);
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ç–µ–º—É –≤ localStorage
            localStorage.setItem('ticTacToeTheme', themeKey);
            currentThemeKey = themeKey;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é —Ç–µ–º—É –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
            updateThemesUI();

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç–∞ –≤ –∏–≥—Ä–æ–≤–æ–º –ø–æ–ª–µ, –µ—Å–ª–∏ –æ–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ
            const cells = boardElement.children;
            for (let i = 0; i < cells.length; i++) {
                const cell = cells[i];
                cell.classList.remove('x', 'o', 'boring-lessons'); // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–ª–∞—Å—Å—ã
                if (gameState[i] !== "") { // –ï—Å–ª–∏ —è—á–µ–π–∫–∞ –Ω–µ –ø—É—Å—Ç–∞—è
                    const player = gameState[i];
                    const markToShow = player === 'X' ? theme.marks.x : theme.marks.o;
                    cell.innerHTML = markToShow;
                    cell.classList.add(player.toLowerCase());
                    if (currentThemeKey === 'boring-lessons') {
                         cell.classList.add('boring-lessons');
                     }
                }
            }


            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã —Ç–µ–º—ã (–µ—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏–º—Å—è –Ω–∞ –∏–≥—Ä–æ–≤–æ–º —ç–∫—Ä–∞–Ω–µ)
             if (document.getElementById('gameScreen').classList.contains('active')) {
                 if (gameActive) {
                     statusDisplay.style.color = root.style.getPropertyValue(currentPlayer === 'X' ? '--x-color' : '--o-color');
                 } else if (statusDisplay.textContent.includes('–ø–æ–±–µ–¥–∏–ª')) {
                      const winner = statusDisplay.textContent.includes('–ò–≥—Ä–æ–∫ X') ? 'X' : 'O';
                      statusDisplay.style.color = root.style.getPropertyValue(winner === 'X' ? '--x-color' : '--o-color');
                 } else if (statusDisplay.textContent.includes('–ù–∏—á—å—è')) {
                      statusDisplay.style.color = root.style.getPropertyValue('--text-color');
                 }
             }
        }

        function populateThemesGrid() {
             ordinaryThemesGridElement.innerHTML = '';
             specialThemesGridElement.innerHTML = '';

             for (const themeKey in themes) {
                 const theme = themes[themeKey];
                 const optionDiv = document.createElement('div');
                 optionDiv.classList.add('theme-option');
                 optionDiv.dataset.themeKey = themeKey;

                 if (themeKey === currentThemeKey) {
                     optionDiv.classList.add('selected');
                 }

                 const previewDiv = document.createElement('div');
                 previewDiv.classList.add('theme-preview');
                 if (themeKey === 'boring-lessons') { // –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü. –∫–ª–∞—Å—Å –¥–ª—è —Å—Ç–∏–ª–µ–π –∫–∞—Ä–∞–Ω–¥–∞—à–∞
                     previewDiv.classList.add('boring-lessons');
                 }

                 // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–µ–≤—å—é —Å–∏–º–≤–æ–ª–æ–≤
                 previewDiv.style.setProperty('--preview-x-color', theme.preview['--preview-x-color']);
                 previewDiv.style.setProperty('--preview-o-color', theme.preview['--preview-o-color']);

                 // –ò—Å–ø–æ–ª—å–∑—É–µ–º marks.x –∏ marks.o –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø—Ä–µ–≤—å—é
                 // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ã—á–Ω—ã–µ X/O, —Ç–æ –±—É–¥—É—Ç position:absolute
                 // –ï—Å–ª–∏ —ç—Ç–æ —Ü–∏—Ñ—Ä—ã/—ç–º–æ–¥–∑–∏, —Ç–æ –±—É–¥—É—Ç —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ textContent
                 const previewX = document.createElement('span');
                 previewX.classList.add('preview-x');
                 previewX.textContent = theme.marks.x;

                 const previewO = document.createElement('span');
                 previewO.classList.add('preview-o');
                 previewO.textContent = theme.marks.o;

                 previewDiv.appendChild(previewX);
                 previewDiv.appendChild(previewO);


                 const nameSpan = document.createElement('span');
                 nameSpan.textContent = theme.name;

                 optionDiv.appendChild(previewDiv);
                 optionDiv.appendChild(nameSpan);

                 optionDiv.addEventListener('click', () => {
                     applyTheme(themeKey);
                 });

                 if (theme.category === 'ordinary') {
                     ordinaryThemesGridElement.appendChild(optionDiv);
                 } else if (theme.category === 'special') {
                     specialThemesGridElement.appendChild(optionDiv);
                 }
             }
        }

        function updateThemesUI() {
             const options = document.querySelectorAll('.theme-option'); // –ò—â–µ–º –≤—Å–µ –æ–ø—Ü–∏–∏ —Ç–µ–º
             options.forEach(option => {
                 if (option.dataset.themeKey === currentThemeKey) {
                     option.classList.add('selected');
                 } else {
                     option.classList.remove('selected');
                 }
             });
         }


        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        applyTheme(localStorage.getItem('ticTacToeTheme') || 'default');

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ—Ç–∫—É —Ç–µ–º –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–∫–∞–∑–µ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
         populateThemesGrid();


        // --- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è PWA (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ) ---
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', function() {
            navigator.serviceWorker.register('/service-worker.js') // –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É Service Worker
              .then(registration => {
                console.log('Service Worker —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration);
              })
              .catch(error => {
                console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
              });
          });
        }

    </script>
</body>
</html>